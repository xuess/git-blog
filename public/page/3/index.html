<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="薛山山在 Github 上的个人博客，主要从事web前端开发，移动端为主。此博客持续更新，欢迎大家关注。"/>













  <link rel="alternate" href="/default" title="午休随笔">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="http://blog.xueshanshan.com/page/3/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />






  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d6060b9d9c759548bc26bce7cb0612fd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









    <title> 午休随笔 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">午休随笔</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">午休随笔</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/05/21/nodejs-express/">nodejs express笔记</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-05-21
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h2 id="Express-应用生成器"><a href="#Express-应用生成器" class="headerlink" title="Express 应用生成器"></a>Express 应用生成器</h2><p>通过应用生成器工具 express 可以快速创建一个应用的骨架。</p>
<p>通过如下命令安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-generator -g</span><br></pre></td></tr></table></figure>
<p>-h 选项可以列出所有可用的命令行选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ express -h</span><br><span class="line"></span><br><span class="line">  Usage: express [options] [dir]</span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line"></span><br><span class="line">    -h, --help           output usage information</span><br><span class="line">        --version        output the version number</span><br><span class="line">    -e, --ejs            add ejs engine support</span><br><span class="line">        --pug            add pug engine support</span><br><span class="line">        --hbs            add handlebars engine support</span><br><span class="line">    -H, --hogan          add hogan.js engine support</span><br><span class="line">    -v, --view &lt;engine&gt;  add view &lt;engine&gt; support (dust|ejs|hbs|hjs|jade|pug|twig|vash) (defaults to jade)</span><br><span class="line">    -c, --css &lt;engine&gt;   add stylesheet &lt;engine&gt; support (less|stylus|compass|sass) (defaults to plain css)</span><br><span class="line">        --git            add .gitignore</span><br><span class="line">    -f, --force          force on non-empty directory</span><br></pre></td></tr></table></figure>
<p>下面的示例就是在当前工作目录下创建一个命名为 myapp 的应用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ express myapp</span><br><span class="line"></span><br><span class="line">  warning: the default view engine will not be jade in future releases</span><br><span class="line">  warning: use `--view=jade&apos; or `--help&apos; for additional options</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   create : myapp</span><br><span class="line">   create : myapp/package.json</span><br><span class="line">   create : myapp/app.js</span><br><span class="line">   create : myapp/public</span><br><span class="line">   create : myapp/routes</span><br><span class="line">   create : myapp/routes/index.js</span><br><span class="line">   create : myapp/routes/users.js</span><br><span class="line">   create : myapp/views</span><br><span class="line">   create : myapp/views/index.jade</span><br><span class="line">   create : myapp/views/layout.jade</span><br><span class="line">   create : myapp/views/error.jade</span><br><span class="line">   create : myapp/bin</span><br><span class="line">   create : myapp/bin/www</span><br><span class="line">   create : myapp/public/javascripts</span><br><span class="line">   create : myapp/public/images</span><br><span class="line">   create : myapp/public/stylesheets</span><br><span class="line">   create : myapp/public/stylesheets/style.css</span><br><span class="line"></span><br><span class="line">   install dependencies:</span><br><span class="line">     $ cd myapp &amp;&amp; npm install</span><br><span class="line"></span><br><span class="line">   run the app:</span><br><span class="line">     $ DEBUG=myapp:* npm start</span><br></pre></td></tr></table></figure>
<p>安装依赖包与运行项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">install dependencies:</span><br><span class="line">$ cd myapp &amp;&amp; npm install</span><br><span class="line"></span><br><span class="line">run the app:</span><br><span class="line">$ DEBUG=myapp:* npm start</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意 <code>mac</code> 和 <code>win</code> 启动命令不同，上面是 <code>mac</code>的，<code>win</code> 请执行 ：<code>set DEBUG=myapp &amp; npm start</code></p>
</blockquote>
<p>然后在浏览器中打开 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a> 网址就可以看到这个应用了</p>
<p>通过 Express 应用生成器创建的应用一般都有如下目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app.js</span><br><span class="line">├── bin</span><br><span class="line">│   └── www</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── javascripts</span><br><span class="line">│   └── stylesheets</span><br><span class="line">│       └── style.css</span><br><span class="line">├── routes</span><br><span class="line">│   ├── index.js</span><br><span class="line">│   └── users.js</span><br><span class="line">└── views</span><br><span class="line">    ├── error.jade</span><br><span class="line">    ├── index.jade</span><br><span class="line">    └── layout.jade</span><br></pre></td></tr></table></figure>
<h2 id="Express-路由"><a href="#Express-路由" class="headerlink" title="Express 路由"></a>Express 路由</h2><p>路由是指如何定义应用的端点（URIs）以及如何响应客户端的请求。</p>
<p>路由是由一个 URI、HTTP 请求（GET、POST等）和若干个句柄组成，它的结构如下： app.METHOD(path, [callback…], callback)， app 是 express 对象的一个实例， METHOD 是一个 HTTP 请求方法， path 是服务器上的路径， callback 是当路由匹配时要执行的函数。</p>
<p>下面是一个基本的路由示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">// respond with &quot;hello world&quot; when a GET request is made to the homepage</span><br><span class="line">app.get(&apos;/&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;hello world&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="路由方法"><a href="#路由方法" class="headerlink" title="路由方法"></a>路由方法</h3><p>路由方法源于 <code>HTTP</code> 请求方法，和 <code>express</code> 实例相关联。</p>
<p>下面这个例子展示了为应用跟路径定义的 <code>GET</code> 和 <code>POST</code> 请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// GET method route</span><br><span class="line">app.get(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;GET request to the homepage&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// POST method route</span><br><span class="line">app.post(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;POST request to the homepage&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Express 定义了如下和 HTTP 请求对应的路由方法： get, post, put, head, delete, options, trace, copy, lock, mkcol, move, purge, propfind, proppatch, unlock, report, mkactivity, checkout, merge, m-search, notify, subscribe, unsubscribe, patch, search, 和 connect。</p>
<blockquote>
<p>有些路由方法名不是合规的 JavaScript 变量名，此时使用括号记法，比如： app[‘m-search’](‘/‘, function …</p>
</blockquote>
<p><code>app.all()</code> 是一个特殊的路由方法，没有任何 <code>HTTP</code> 方法与其对应，它的作用是对于一个路径上的所有请求加载中间件。</p>
<p>在下面的例子中，来自 “<code>/secret</code>” 的请求，不管使用 <code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code> 或其他任何 <code>http</code> 模块支持的 <code>HTTP</code> 请求，句柄都会得到执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.all(&apos;/secret&apos;, function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;Accessing the secret section ...&apos;);</span><br><span class="line">  next(); // pass control to the next handler</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="路由路径"><a href="#路由路径" class="headerlink" title="路由路径"></a>路由路径</h3><p>路由路径和请求方法一起定义了请求的端点，它可以是字符串、字符串模式或者正则表达式。</p>
<p>Express 使用 <code>path-to-regexp</code> 匹配路由路径，请参考文档查阅所有定义路由路径的方法。 Express <code>Route Tester</code> 是测试基本 Express 路径的好工具，但不支持模式匹配。</p>
<blockquote>
<p>查询字符串不是路由路径的一部分。</p>
</blockquote>
<p>使用字符串的路由路径示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 匹配根路径的请求</span><br><span class="line">app.get(&apos;/&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;root&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 /about 路径的请求</span><br><span class="line">app.get(&apos;/about&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;about&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 /random.text 路径的请求</span><br><span class="line">app.get(&apos;/random.text&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;random.text&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用字符串模式的路由路径示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 匹配 acd 和 abcd</span><br><span class="line">app.get(&apos;/ab?cd&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;ab?cd&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 abcd、abbcd、abbbcd等</span><br><span class="line">app.get(&apos;/ab+cd&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;ab+cd&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 abcd、abxcd、abRABDOMcd、ab123cd等</span><br><span class="line">app.get(&apos;/ab*cd&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;ab*cd&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 /abe 和 /abcde</span><br><span class="line">app.get(&apos;/ab(cd)?e&apos;, function(req, res) &#123;</span><br><span class="line"> res.send(&apos;ab(cd)?e&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>字符 ?、+、* 和 () 是正则表达式的子集，- 和 . 在基于字符串的路径中按照字面值解释。</p>
</blockquote>
<p>使用正则表达式的路由路径示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 匹配任何路径中含有 a 的路径：</span><br><span class="line">app.get(/a/, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;/a/&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 匹配 butterfly、dragonfly，不匹配 butterflyman、dragonfly man等</span><br><span class="line">app.get(/.*fly$/, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;/.*fly$/&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="路由句柄"><a href="#路由句柄" class="headerlink" title="路由句柄"></a>路由句柄</h3><p>可以为请求处理提供多个回调函数，其行为类似 <code>中间件</code>。唯一的区别是这些回调函数有可能调用 <code>next(&#39;route&#39;)</code> 方法而略过其他路由回调函数。可以利用该机制为路由定义前提条件，如果在现有路径上继续执行没有意义，则可将控制权交给剩下的路径。</p>
<p>路由句柄有多种形式，可以是一个函数、一个函数数组，或者是两者混合，如下所示.</p>
<p>使用一个回调函数处理路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(&apos;/example/a&apos;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;Hello from A!&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用多个回调函数处理路由（记得指定 <code>next</code> 对象）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.get(&apos;/example/b&apos;, function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;response will be sent by the next function ...&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;Hello from B!&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>使用回调函数数组处理路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var cb0 = function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;CB0&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var cb1 = function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;CB1&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var cb2 = function (req, res) &#123;</span><br><span class="line">  res.send(&apos;Hello from C!&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(&apos;/example/c&apos;, [cb0, cb1, cb2]);</span><br></pre></td></tr></table></figure>
<p>混合使用函数和函数数组处理路由：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var cb0 = function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;CB0&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var cb1 = function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;CB1&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(&apos;/example/d&apos;, [cb0, cb1], function (req, res, next) &#123;</span><br><span class="line">  console.log(&apos;response will be sent by the next function ...&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;, function (req, res) &#123;</span><br><span class="line">  res.send(&apos;Hello from D!&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="响应方法"><a href="#响应方法" class="headerlink" title="响应方法"></a>响应方法</h3><p>下表中响应对象（res）的方法向客户端返回响应，终结请求响应的循环。如果在路由句柄中一个方法也不调用，来自客户端的请求会一直挂起。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述 </th>
</tr>
</thead>
<tbody>
<tr>
<td>res.download()</td>
<td>提示下载文件。</td>
</tr>
<tr>
<td>res.end()</td>
<td>终结响应处理流程。</td>
</tr>
<tr>
<td>res.json()</td>
<td>发送一个 JSON 格式的响应。</td>
</tr>
<tr>
<td>res.jsonp()</td>
<td>发送一个支持 JSONP 的 JSON 格式的响应。</td>
</tr>
<tr>
<td>res.redirect()</td>
<td>重定向请求。</td>
</tr>
<tr>
<td>res.render()</td>
<td>渲染视图模板。</td>
</tr>
<tr>
<td>res.send()</td>
<td>发送各种类型的响应。</td>
</tr>
<tr>
<td>res.sendFile()</td>
<td>以八位字节流的形式发送文件。 sendfile(‘login.html’);</td>
</tr>
<tr>
<td>res.sendStatus()</td>
<td>设置响应状态代码，并将其以字符串形式作为响应体的一部分发送。</td>
</tr>
</tbody>
</table>
<h3 id="app-route"><a href="#app-route" class="headerlink" title="app.route()"></a>app.route()</h3><p>可使用 <code>app.route()</code> 创建路由路径的链式路由句柄。由于路径在一个地方指定，这样做有助于创建模块化的路由，而且减少了代码冗余和拼写错误。请参考 <code>Router()</code> 文档 了解更多有关路由的信息。</p>
<p>下面这个示例程序使用 <code>app.route()</code> 定义了链式路由句柄。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.route(&apos;/book&apos;)</span><br><span class="line">  .get(function(req, res) &#123;</span><br><span class="line">    res.send(&apos;Get a random book&apos;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(function(req, res) &#123;</span><br><span class="line">    res.send(&apos;Add a book&apos;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .put(function(req, res) &#123;</span><br><span class="line">    res.send(&apos;Update the book&apos;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="express-Router"><a href="#express-Router" class="headerlink" title="express.Router"></a>express.Router</h3><p>可使用 <code>express.Router</code> 类创建模块化、可挂载的路由句柄。<code>Router</code> 实例是一个完整的中间件和路由系统，因此常称其为一个 “<code>mini-app</code>”。</p>
<p>下面的实例程序创建了一个路由模块，并加载了一个中间件，定义了一些路由，并且将它们挂载至应用的路径上。</p>
<p>在 <code>app</code> 目录下创建名为 <code>birds.js</code> 的文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">// 该路由使用的中间件</span><br><span class="line">router.use(function timeLog(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;Time: &apos;, Date.now());</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line">// 定义网站主页的路由</span><br><span class="line">router.get(&apos;/&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;Birds home page&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">// 定义 about 页面的路由</span><br><span class="line">router.get(&apos;/about&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;About birds&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p>然后在应用中加载路由模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var birds = require(&apos;./birds&apos;);</span><br><span class="line">...</span><br><span class="line">app.use(&apos;/birds&apos;, birds);</span><br></pre></td></tr></table></figure>
<p>应用即可处理发自 <code>/birds</code> 和 <code>/birds/about</code> 的请求，并且调用为该路由指定的 <code>timeLog</code> 中间件。</p>
<h2 id="利用-Express-托管静态文件"><a href="#利用-Express-托管静态文件" class="headerlink" title="利用 Express 托管静态文件"></a>利用 Express 托管静态文件</h2><p>通过 <code>Express</code> 内置的 <code>express.static</code> 可以方便地托管静态文件，例如<code>图片</code>、<code>CSS</code>、<code>JavaScript</code> 文件等。</p>
<p>将静态资源文件所在的目录作为参数传递给 <code>express.static</code> 中间件就可以提供静态资源文件的访问了。例如，假设在 <code>public</code> 目录放置了<code>图片</code>、<code>CSS</code> 和 <code>JavaScript</code> 文件，你就可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&apos;public&apos;));</span><br></pre></td></tr></table></figure>
<p>现在，<code>public</code> 目录下面的文件就可以访问了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/images/kitten.jpg</span><br><span class="line">http://localhost:3000/css/style.css</span><br><span class="line">http://localhost:3000/js/app.js</span><br><span class="line">http://localhost:3000/images/bg.png</span><br><span class="line">http://localhost:3000/hello.html</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所有文件的路径都是相对于存放目录的，因此，存放静态文件的目录名不会出现在 <code>URL</code> 中。</p>
</blockquote>
<p>如果你的静态资源存放在多个目录下面，你可以多次调用 <code>express.static</code> 中间件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(&apos;public&apos;));</span><br><span class="line">app.use(express.static(&apos;files&apos;));</span><br></pre></td></tr></table></figure>
<p>访问静态资源文件时，<code>express.static</code> 中间件会根据目录添加的顺序查找所需的文件。</p>
<p>如果你希望所有通过 <code>express.static</code> 访问的文件都存放在一个“<code>虚拟（virtual）</code>”目录（即目录根本不存在）下面，可以通过为静态资源目录指定一个挂载路径的方式来实现，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(&apos;/static&apos;, express.static(&apos;public&apos;));</span><br></pre></td></tr></table></figure>
<p>现在，你就爱可以通过带有 “<code>/static</code>” 前缀的地址来访问 <code>public</code> 目录下面的文件了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/static/images/kitten.jpg</span><br><span class="line">http://localhost:3000/static/css/style.css</span><br><span class="line">http://localhost:3000/static/js/app.js</span><br><span class="line">http://localhost:3000/static/images/bg.png</span><br><span class="line">http://localhost:3000/static/hello.html</span><br></pre></td></tr></table></figure>
<h3 id="中间件与-next"><a href="#中间件与-next" class="headerlink" title="中间件与 next"></a>中间件与 next</h3><p><code>express</code> 中的中间件（middleware）就是用来处理请求的，当一个中间件处理完，可以通过调用 <code>next()</code> 传递给下一个中间件，如果没有调用 <code>next()</code>，则请求不会往下传递，如内置的 <code>res.render</code> 其实就是渲染完 <code>html</code> 直接返回给客户端，没有调用 <code>next()</code>，从而没有传递给下一个中间件。看个小例子，修改 <code>index.js</code> 如下：</p>
<p><strong>index.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;1&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;2&apos;);</span><br><span class="line">  res.status(200).end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>
<p>此时访问 localhost:3000，终端会输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>通过 <code>app.use</code> 加载中间件，在中间件中通过 <code>next</code> 将请求传递到下一个中间件，<code>next</code> 可接受一个参数接收错误信息，如果使用了 <code>next(error)</code>，则会返回错误而不会传递到下一个中间件，修改 <code>index.js</code> 如下：</p>
<p><strong>index.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;1&apos;);</span><br><span class="line">  next(new Error(&apos;haha&apos;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;2&apos;);</span><br><span class="line">  res.status(200).end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>
<p>报错信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Error: haha</span><br><span class="line">    at /Users/shanshanxue/Documents/workspace/aym_admin_nav/index.js:6:8</span><br><span class="line">    at Layer.handle [as handle_request] (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at trim_prefix (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:317:13)</span><br><span class="line">    at /Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:284:7</span><br><span class="line">    at next (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:275:10)</span><br><span class="line">    at expressInit (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/middleware/init.js:40:5)</span><br><span class="line">    at Layer.handle [as handle_request] (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/layer.js:95:5)</span><br><span class="line">    at trim_prefix (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:317:13)</span><br><span class="line">    at /Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:284:7</span><br><span class="line">    at next (/Users/shanshanxue/Documents/workspace/aym_admin_nav/node_modules/express/lib/router/index.js:275:10)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>小提示：<code>app.use</code> 有非常灵活的使用方式，详情见 <a href="http://expressjs.com/en/4x/api.html#app.use" target="_blank" rel="noopener">官方文档</a>。</p>
</blockquote>
<p><code>express</code> 有成百上千的第三方中间件，在开发过程中我们首先应该去 <code>npm</code> 上寻找是否有类似实现的中间件，尽量避免造轮子，节省开发时间。下面给出几个常用的搜索 npm 模块的网站：</p>
<ol>
<li><a href="http://npmjs.com" target="_blank" rel="noopener">http://npmjs.com</a>(npm 官网)</li>
<li><a href="http://node-modules.com" target="_blank" rel="noopener">http://node-modules.com</a></li>
<li><a href="https://npms.io" target="_blank" rel="noopener">https://npms.io</a></li>
<li><a href="https://nodejsmodules.org" target="_blank" rel="noopener">https://nodejsmodules.org</a></li>
</ol>
<blockquote>
<p>小提示：<code>express@4</code> 之前的版本基于 <code>connect</code> 这个模块实现的中间件的架构，<code>express@4</code> 及以上的版本则移除了对 <code>connect</code> 的依赖自己实现了，理论上基于 <code>connect</code> 的中间件（通常以 <code>connect-</code> 开头，如 <code>connect-mongo</code>）仍可结合 <code>express</code> 使用。</p>
<p>注意：中间件的加载顺序很重要！比如：通常把日志中间件放到比较靠前的位置，后面将会介绍的 <code>connect-flash</code> 中间件是基于 <code>session</code> 的，所以需要在 <code>express-session</code> 后加载。</p>
</blockquote>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>上面的例子中，应用程序为我们自动返回了错误栈信息（<code>express</code> 内置了一个默认的错误处理器），假如我们想手动控制返回的错误内容，则需要加载一个自定义错误处理的中间件，修改 <code>index.js</code> 如下：</p>
<p><strong>index.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;1&apos;);</span><br><span class="line">  next(new Error(&apos;haha&apos;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(function(req, res, next) &#123;</span><br><span class="line">  console.log(&apos;2&apos;);</span><br><span class="line">  res.status(200).end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//错误处理</span><br><span class="line">app.use(function(err, req, res, next) &#123;</span><br><span class="line">  console.error(err.stack);</span><br><span class="line">  res.status(500).send(&apos;Something broke!&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>
<p>此时访问 <code>localhost:3000</code>，浏览器会显示 <code>Something broke!</code>。</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/04/24/linux-command/">linux 重用命令整理</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-04-24
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><h3 id="cat-etc-redhat-release"><a href="#cat-etc-redhat-release" class="headerlink" title="cat /etc/redhat-release"></a>cat /etc/redhat-release</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure>
<h3 id="uname-a"><a href="#uname-a" class="headerlink" title="uname -a"></a>uname -a</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux vps_jp_2018_2 4.14.13-1.el7.elrepo.x86_64 <span class="comment">#1 SMP Wed Jan 10 15:12:12 EST 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>
<h2 id="重命名例子："><a href="#重命名例子：" class="headerlink" title="重命名例子："></a>重命名例子：</h2><p>1) 将一个名为abc.txt的文件重命名为1234.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv abc.txt 1234.txt</span><br></pre></td></tr></table></figure>
<p>2) 将目录A重命名为B</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv A B</span><br></pre></td></tr></table></figure>
<p>3) 将a.txt移动到/b下，并重命名为c.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv a.txt /b/c.txt</span><br></pre></td></tr></table></figure>
<h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><p>将压缩文件test.zip在指定目录/tmp下解压缩，如果已有相同的文件存在，要求unzip命令覆盖原先的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip -o test.zip -d tmp/</span><br></pre></td></tr></table></figure>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/04/22/react-flux/">react-flux</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-04-22
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* View： 视图层</span><br><span class="line">* Action（动作）：视图层发出的消息（比如mouseClick）</span><br><span class="line">* Dispatcher（派发器）：用来接收Actions、执行回调函数</span><br><span class="line">* Store（数据层）：用来存放应用的状态，一旦发生变动，就提醒Views要更新页面</span><br></pre></td></tr></table></figure>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016011503.png" alt="image"></p>
<p><code>Flux</code> 的最大特点，就是数据的<code>&quot;单向流动&quot;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 用户访问 View</span><br><span class="line">2. View 发出用户的 Action</span><br><span class="line">3. Dispatcher 收到 Action，要求 Store 进行相应的更新</span><br><span class="line">4. Store 更新后，发出一个&quot;change&quot;事件</span><br><span class="line">5. View 收到&quot;change&quot;事件后，更新页面</span><br></pre></td></tr></table></figure>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/04/02/react-document/">react学习记录</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-04-02
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h3 id="知识体系"><a href="#知识体系" class="headerlink" title="知识体系"></a>知识体系</h3><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>上面代码中，变量 <code>HelloMessage</code> 就是一个组件类。模板插入<code>&lt;HelloMessage /&gt;</code> 时，会自动生成 <code>HelloMessage</code> 的一个实例（下文的”组件”都指组件类的实例）。所有组件类都必须有自己的 <code>render</code> 方法，用于输出组件。</p>
<p>注意，组件类的第一个字母必须大写，否则会报错，比如<code>HelloMessage</code>不能写成<code>helloMessage</code>。<br><br><br>另外，组件类只能包含<code>一个顶层标签</code>，否则也会报错。</p>
<p>添加组件属性，有一个地方需要注意，就是 <code>class</code> 属性需要写成 <code>className</code> ，<code>for</code> 属性需要写成 <code>htmlFor</code> ，这是因为 <code>class</code> 和 <code>for</code> 是 JavaScript 的<code>保留字</code>。</p>
<h3 id="this-props-children"><a href="#this-props-children" class="headerlink" title="this.props.children"></a>this.props.children</h3><p><code>this.props</code> 对象的属性与组件的属性一一对应，但是有一个例外，就是 <code>this.props.children</code> 属性。它表示组件的<code>所有子节点</code></p>
<p>这里需要注意， <code>this.props.children</code> 的值有三种可能：如果当前组件<code>没有子节点</code>，它就是 <code>undefined</code> ;如果有<code>一个子节点</code>，数据类型是 <code>object</code> ；如果有<code>多个子节点</code>，数据类型就是 <code>array</code> 。所以，处理 <code>this.props.children</code> 的时候要小心。</p>
<p><code>React</code> 提供一个工具方法 <code>React.Children</code> 来处理 <code>this.props.children</code> 。我们可以用 <code>React.Children.map</code> 来遍历子节点，而不用担心 <code>this.props.children</code> 的数据类型是 <code>undefined</code> 还是 <code>object</code>。更多的 <code>React.Children</code> 的方法 <a href="https://reactjs.org/docs/react-api.html#react.children" target="_blank" rel="noopener">参考官网文档</a></p>
<h3 id="PropTypes"><a href="#PropTypes" class="headerlink" title="PropTypes"></a>PropTypes</h3><p>组件的属性可以接受任意值，字符串、对象、函数等等都可以。有时，我们需要一种机制，验证别人使用组件时，提供的参数是否符合要求。</p>
<p>组件类的PropTypes属性，就是用来验证组件实例的属性是否符合要求</p>
<blockquote>
<p>注意: <code>React.PropTypes</code> 自 React <code>v15.5</code> 起已弃用。请使用 <a href="https://www.npmjs.com/package/prop-types" target="_blank" rel="noopener">prop-types</a> 库代替。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import PropTypes from &apos;prop-types&apos;;</span><br><span class="line"></span><br><span class="line">class Greeting extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;h1&gt;Hello, &#123;this.props.name&#125;&lt;/h1&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Greeting.propTypes = &#123;</span><br><span class="line">  name: PropTypes.string</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>PropTypes</code> 包含一整套验证器，可用于确保你接收的数据是有效的。在这个示例中，我们使用了 <code>PropTypes.string</code>。当你给属性传递了无效值时，<code>JavsScript</code> 控制台将会打印警告。出于性能原因，<code>propTypes</code> 只在开发模式下进行检查。</p>
<p>下面是使用不同验证器的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import PropTypes from &apos;prop-types&apos;;</span><br><span class="line"></span><br><span class="line">MyComponent.propTypes = &#123;</span><br><span class="line">  // 你可以将属性声明为以下 JS 原生类型</span><br><span class="line">  optionalArray: PropTypes.array,</span><br><span class="line">  optionalBool: PropTypes.bool,</span><br><span class="line">  optionalFunc: PropTypes.func,</span><br><span class="line">  optionalNumber: PropTypes.number,</span><br><span class="line">  optionalObject: PropTypes.object,</span><br><span class="line">  optionalString: PropTypes.string,</span><br><span class="line">  optionalSymbol: PropTypes.symbol,</span><br><span class="line"></span><br><span class="line">  // 任何可被渲染的元素（包括数字、字符串、子元素或数组）。</span><br><span class="line">  optionalNode: PropTypes.node,</span><br><span class="line"></span><br><span class="line">  // 一个 React 元素</span><br><span class="line">  optionalElement: PropTypes.element,</span><br><span class="line"></span><br><span class="line">  // 你也可以声明属性为某个类的实例，这里使用 JS 的</span><br><span class="line">  // instanceof 操作符实现。</span><br><span class="line">  optionalMessage: PropTypes.instanceOf(Message),</span><br><span class="line"></span><br><span class="line">  // 你也可以限制你的属性值是某个特定值之一</span><br><span class="line">  optionalEnum: PropTypes.oneOf([&apos;News&apos;, &apos;Photos&apos;]),</span><br><span class="line"></span><br><span class="line">  // 限制它为列举类型之一的对象</span><br><span class="line">  optionalUnion: PropTypes.oneOfType([</span><br><span class="line">    PropTypes.string,</span><br><span class="line">    PropTypes.number,</span><br><span class="line">    PropTypes.instanceOf(Message)</span><br><span class="line">  ]),</span><br><span class="line"></span><br><span class="line">  // 一个指定元素类型的数组</span><br><span class="line">  optionalArrayOf: PropTypes.arrayOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  // 一个指定类型的对象</span><br><span class="line">  optionalObjectOf: PropTypes.objectOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  // 一个指定属性及其类型的对象</span><br><span class="line">  optionalObjectWithShape: PropTypes.shape(&#123;</span><br><span class="line">    color: PropTypes.string,</span><br><span class="line">    fontSize: PropTypes.number</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  // 你也可以在任何 PropTypes 属性后面加上 `isRequired` </span><br><span class="line">  // 后缀，这样如果这个属性父组件没有提供时，会打印警告信息</span><br><span class="line">  requiredFunc: PropTypes.func.isRequired,</span><br><span class="line"></span><br><span class="line">  // 任意类型的数据</span><br><span class="line">  requiredAny: PropTypes.any.isRequired,</span><br><span class="line"></span><br><span class="line">  // 你也可以指定一个自定义验证器。它应该在验证失败时返回</span><br><span class="line">  // 一个 Error 对象而不是 `console.warn` 或抛出异常。</span><br><span class="line">  // 不过在 `oneOfType` 中它不起作用。</span><br><span class="line">  customProp: function(props, propName, componentName) &#123;</span><br><span class="line">    if (!/matchme/.test(props[propName])) &#123;</span><br><span class="line">      return new Error(</span><br><span class="line">        &apos;Invalid prop `&apos; + propName + &apos;` supplied to&apos; +</span><br><span class="line">        &apos; `&apos; + componentName + &apos;`. Validation failed.&apos;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 不过你可以提供一个自定义的 `arrayOf` 或 `objectOf` </span><br><span class="line">  // 验证器，它应该在验证失败时返回一个 Error 对象。 它被用</span><br><span class="line">  // 于验证数组或对象的每个值。验证器前两个参数的第一个是数组</span><br><span class="line">  // 或对象本身，第二个是它们对应的键。</span><br><span class="line">  customArrayProp: PropTypes.arrayOf(function(propValue, key, componentName, location, propFullName) &#123;</span><br><span class="line">    if (!/matchme/.test(propValue[key])) &#123;</span><br><span class="line">      return new Error(</span><br><span class="line">        &apos;Invalid prop `&apos; + propFullName + &apos;` supplied to&apos; +</span><br><span class="line">        &apos; `&apos; + componentName + &apos;`. Validation failed.&apos;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="获取真实的DOM节点-ref"><a href="#获取真实的DOM节点-ref" class="headerlink" title="获取真实的DOM节点 ref"></a>获取真实的DOM节点 ref</h3><p>有时需要从组件获取真实 DOM 的节点，这时就要用到 <code>ref</code> 属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//es5</span><br><span class="line">var MyComponent = React.createClass(&#123;</span><br><span class="line">  handleClick: function() &#123;</span><br><span class="line">    this.refs.myTextInput.focus();</span><br><span class="line">  &#125;,</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; ref=&quot;myTextInput&quot; /&gt;</span><br><span class="line">        &lt;input type=&quot;button&quot; value=&quot;Focus the text input&quot; onClick=&#123;this.handleClick&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;MyComponent /&gt;,</span><br><span class="line">  document.getElementById(&apos;example&apos;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><a href="https://doc.react-china.org/docs/refs-and-the-dom.html" target="_blank" rel="noopener">参考官方文档</a></p>
<blockquote>
<p>旧版 API：String 类型的 Refs<br>如果你之前使用过 React ，你可能了解过之前的API中的 string 类型的 ref 属性，比如 “textInput” ，你可以通过 this.refs.textInput 访问DOM节点。我们不建议使用它，因为 String 类型的 refs 存在问题。它已过时并可能会在未来的版本是移除。如果你目前还在使用 this.refs.textInput 这种方式访问 refs ，我们建议用回调函数的方式代替。</p>
</blockquote>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/03/22/react-es6/">react es6</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-03-22
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// Correct</span><br><span class="line">this.setState((prevState, props) =&gt; (&#123;</span><br><span class="line">  counter: prevState.counter + props.increment</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">// Correct</span><br><span class="line">this.setState(function(prevState, props) &#123;</span><br><span class="line">  return &#123;</span><br><span class="line">    counter: prevState.counter + props.increment</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">箭头函数 ：</span><br><span class="line">var aaa = (a,b) =&gt; &#123;console.log(a)&#125;</span><br><span class="line"></span><br><span class="line">var aaa = function (a,b)&#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var aaa = (a,b) =&gt;(</span><br><span class="line">    a+b</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var  aaa = function(a,b)&#123;</span><br><span class="line">    return a+b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var aaa = (a,b) =&gt;(</span><br><span class="line">    &#123;a:a,b:b&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var  aaa = function(a,b)&#123;</span><br><span class="line">    return &#123;a:a,b:b&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>计算属性 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">**es6**</span><br><span class="line">this.setState(&#123;</span><br><span class="line">  [name]: value</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">**es5**</span><br><span class="line">var partialState = &#123;&#125;;</span><br><span class="line">partialState[name] = value;</span><br><span class="line">this.setState(partialState);</span><br></pre></td></tr></table></figure>
        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2017/01/25/es6-grammar/">es6语法简介</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-01-25
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h2 id="let与var用法区别"><a href="#let与var用法区别" class="headerlink" title="let与var用法区别"></a>let与var用法区别</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">//var </span><br><span class="line">var a = [];</span><br><span class="line">for (var i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">  a[i] = function () &#123;</span><br><span class="line">    console.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">a[6](); // 10</span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line">//let</span><br><span class="line">var a = [];</span><br><span class="line">for (let i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">  a[i] = function () &#123;</span><br><span class="line">    console.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">a[6](); // 6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//如果不用 let 实现类似功能</span><br><span class="line">function iteratorFactory(i)&#123;</span><br><span class="line">    var onclick = function(e)&#123;</span><br><span class="line">        console.log(i)</span><br><span class="line">    &#125;</span><br><span class="line">    return onclick;</span><br><span class="line">&#125;</span><br><span class="line">var clickBoxs = document.querySelectorAll(&apos;.clickBox&apos;)</span><br><span class="line">for (var i = 0; i &lt; clickBoxs.length; i++)&#123;</span><br><span class="line">    clickBoxs[i].onclick = iteratorFactory(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="class-extends-super"><a href="#class-extends-super" class="headerlink" title="class, extends, super"></a>class, extends, super</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class Animal &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.type = &apos;animal&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    says(say)&#123;</span><br><span class="line">        console.log(this.type + &apos; says &apos; + say)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let animal = new Animal()</span><br><span class="line">animal.says(&apos;hello&apos;) //animal says hello</span><br><span class="line"></span><br><span class="line">//继承</span><br><span class="line">class Cat extends Animal &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        super()</span><br><span class="line">        this.type = &apos;cat&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let cat = new Cat()</span><br><span class="line">cat.says(&apos;hello&apos;) //cat says hello</span><br></pre></td></tr></table></figure>
<p>上面代码首先用<code>class</code>定义了一个“类”，可以看到里面有一个<code>constructor</code>方法，这就是构造方法，而<code>this</code>关键字则代表实例对象。简单地说，<code>constructor</code>内定义的方法和属性是实例对象自己的，而<code>constructor</code>外定义的方法和属性则是所有实例对象可以共享的。</p>
<p><code>Class</code>之间可以通过<code>extends</code>关键字实现继承，这比<code>ES5</code>的通过修改原型链实现继承，要清晰和方便很多。</p>
<p><code>super</code>关键字，它指代父类的实例（即父类的<code>this</code>对象）。子类必须在<code>constructor</code>方法中调用<code>super</code>方法，否则新建实例时会报错。<br>这是因为子类没有自己的<code>this</code>对象，而是继承父类的<code>this</code>对象，然后对其进行加工。如果不调用<code>super</code>方法，子类就得不到<code>this</code>对象。</p>
<p><code>ES6</code>的继承机制，实质是先创造父类的实例对象<code>this</code>（所以必须先调用<code>super</code>方法），然后再用子类的构造函数修改<code>this</code>。</p>
<h2 id="箭头函数-arrow-function"><a href="#箭头函数-arrow-function" class="headerlink" title="箭头函数 arrow function"></a>箭头函数 arrow function</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function(i)&#123; return i + 1; &#125; //ES5</span><br><span class="line">(i) =&gt; i + 1 //ES6</span><br></pre></td></tr></table></figure>
<p>如果方程比较复杂，则需要用<code>{}</code>把代码包起来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//es5</span><br><span class="line">function(x, y) &#123; </span><br><span class="line">    x++;</span><br><span class="line">    y--;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br><span class="line">//es6</span><br><span class="line">(x, y) =&gt; &#123;x++; y--; return x+y&#125;</span><br></pre></td></tr></table></figure>
<p>除了看上去更简洁以外，<code>arrow function</code>还有一项超级无敌的功能！<br>长期以来，JavaScript语言的<code>this</code>对象一直是一个令人头痛的问题，在对象方法中使用<code>this</code>，必须非常小心。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//错误代码</span><br><span class="line">class Animal &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.type = &apos;animal&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    says(say)&#123;</span><br><span class="line">        setTimeout(function()&#123;</span><br><span class="line">            console.log(this.type + &apos; says &apos; + say)</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> var animal = new Animal()</span><br><span class="line"> animal.says(&apos;hi&apos;)  //undefined says hi</span><br></pre></td></tr></table></figure>
<p>运行上面的代码会报错，这是因为<code>setTimeout</code>中的<code>this</code>指向的是全局对象。所以为了让它能够正确的运行，传统的解决方法有两种：</p>
<p>1.第一种是将<code>this</code>传给<code>self</code>,再用<code>self</code>来指代<code>this</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">says(say)&#123;</span><br><span class="line">   var self = this;</span><br><span class="line">   setTimeout(function()&#123;</span><br><span class="line">       console.log(self.type + &apos; says &apos; + say)</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure>
<p>2.第二种方法是用<code>bind(this)</code>,即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">says(say)&#123;</span><br><span class="line">    setTimeout(function()&#123;</span><br><span class="line">        console.log(this.type + &apos; says &apos; + say)</span><br><span class="line">    &#125;.bind(this), 1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但现在我们有了箭头函数，就不需要这么麻烦了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Animal &#123;</span><br><span class="line">    constructor()&#123;</span><br><span class="line">        this.type = &apos;animal&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    says(say)&#123;</span><br><span class="line">        setTimeout( () =&gt; &#123;</span><br><span class="line">            console.log(this.type + &apos; says &apos; + say)</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> var animal = new Animal()</span><br><span class="line"> animal.says(&apos;hi&apos;)  //animal says hi</span><br></pre></td></tr></table></figure>
<p>当我们使用箭头函数时，函数体内的<code>this</code>对象，就是<code>定义时</code>所在的对象，而不是使用时所在的对象。<br>并不是因为箭头函数内部有绑定this的机制，实际原因是箭头函数根本<code>没有自己的this</code>，它的this是<code>继承外面的</code>，因此内部的this就是外层代码块的this。</p>
<h2 id="模板字符串-template-string"><a href="#模板字符串-template-string" class="headerlink" title="模板字符串 template string"></a>模板字符串 template string</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//不用模板字符串 写法</span><br><span class="line">$(&quot;#result&quot;).append(</span><br><span class="line">  &quot;There are &lt;b&gt;&quot; + basket.count + &quot;&lt;/b&gt; &quot; +</span><br><span class="line">  &quot;items in your basket, &quot; +</span><br><span class="line">  &quot;&lt;em&gt;&quot; + basket.onSale +</span><br><span class="line">  &quot;&lt;/em&gt; are on sale!&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//使用模板字符串写法</span><br><span class="line">$(&quot;#result&quot;).append(`</span><br><span class="line">  There are &lt;b&gt;$&#123;basket.count&#125;&lt;/b&gt; items</span><br><span class="line">   in your basket, &lt;em&gt;$&#123;basket.onSale&#125;&lt;/em&gt;</span><br><span class="line">  are on sale!</span><br><span class="line">`);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用反引号（`）来标识起始，用<code>${}</code>来引用变量，而且所有的<code>空格和缩进</code>都会被保留在输出之中(==这个需要注意==)</p>
</blockquote>
<h2 id="解构-destructuring"><a href="#解构-destructuring" class="headerlink" title="解构 destructuring"></a>解构 destructuring</h2><p><code>ES6</code>允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（<code>Destructuring</code>）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let cat = &apos;ken&apos;</span><br><span class="line">let dog = &apos;lili&apos;</span><br><span class="line">let zoo = &#123;cat: cat, dog: dog&#125;</span><br><span class="line">console.log(zoo)  //Object &#123;cat: &quot;ken&quot;, dog: &quot;lili&quot;&#125;</span><br><span class="line"></span><br><span class="line">//使用es6解构</span><br><span class="line">let cat = &apos;ken&apos;</span><br><span class="line">let dog = &apos;lili&apos;</span><br><span class="line">let zoo = &#123;cat, dog&#125;</span><br><span class="line">console.log(zoo)  //Object &#123;cat: &quot;ken&quot;, dog: &quot;lili&quot;&#125;</span><br><span class="line"></span><br><span class="line">//反过来可以这么写：</span><br><span class="line">let dog = &#123;type: &apos;animal&apos;, many: 2&#125;</span><br><span class="line">let &#123; type, many&#125; = dog</span><br><span class="line">console.log(type, many)   //animal 2</span><br></pre></td></tr></table></figure>
<h2 id="默认值-default"><a href="#默认值-default" class="headerlink" title="默认值 default"></a>默认值 default</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function animal(type)&#123;</span><br><span class="line">    type = type || &apos;cat&apos;  </span><br><span class="line">    console.log(type)</span><br><span class="line">&#125;</span><br><span class="line">animal()</span><br><span class="line"></span><br><span class="line">//ES6</span><br><span class="line">function animal(type = &apos;cat&apos;)&#123;</span><br><span class="line">    console.log(type)</span><br><span class="line">&#125;</span><br><span class="line">animal()</span><br></pre></td></tr></table></figure>
<h2 id="展开操作符-rest-arguments-…"><a href="#展开操作符-rest-arguments-…" class="headerlink" title="展开操作符 rest arguments (…)"></a>展开操作符 rest arguments (…)</h2><p><a href="http://blog.csdn.net/qq_30100043/article/details/53391308" target="_blank" rel="noopener">扩展运算符详细介绍</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function animals(...types)&#123;</span><br><span class="line">    console.log(types)</span><br><span class="line">&#125;</span><br><span class="line">animals(&apos;cat&apos;, &apos;dog&apos;, &apos;fish&apos;) //[&quot;cat&quot;, &quot;dog&quot;, &quot;fish&quot;]</span><br></pre></td></tr></table></figure>
<h2 id="import-export"><a href="#import-export" class="headerlink" title="import export"></a>import export</h2><p><strong>传统的写法</strong>CommonJS(服务器端)和AMD（浏览器端，如require.js）</p>
<p>AMD写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//content.js</span><br><span class="line">define(&apos;content.js&apos;, function()&#123;</span><br><span class="line">    return &apos;A cat&apos;;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//index.js</span><br><span class="line">require([&apos;./content.js&apos;], function(animal)&#123;</span><br><span class="line">    console.log(animal);   //A cat</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>CommonJS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line">var animal = require(&apos;./content.js&apos;)</span><br><span class="line"></span><br><span class="line">//content.js</span><br><span class="line">module.exports = &apos;A cat&apos;</span><br></pre></td></tr></table></figure>
<p>ES6的写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line">import animal from &apos;./content&apos;</span><br><span class="line"></span><br><span class="line">//content.js</span><br><span class="line">export default &apos;A cat&apos;</span><br></pre></td></tr></table></figure>
<p>ES6 module的其他高级用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//content.js</span><br><span class="line">export default &apos;A cat&apos;    </span><br><span class="line">export function say()&#123;</span><br><span class="line">    return &apos;Hello!&apos;</span><br><span class="line">&#125;    </span><br><span class="line">export const type = &apos;dog&apos; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//index.js</span><br><span class="line">import &#123; say, type &#125; from &apos;./content&apos;  </span><br><span class="line">let says = say()</span><br><span class="line">console.log(`The $&#123;type&#125; says $&#123;says&#125;`)  //The dog says Hello</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里输入的时候要注意：<code>大括号</code>里面的<code>变量名</code>，必须与被导入模块（content.js）对外接口的<code>名称相同</code>。<br>如果还希望输入content.js中输出的<code>默认值</code>(default), 可以写在大括号外面。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line">import animal, &#123; say, type &#125; from &apos;./content&apos;  </span><br><span class="line">let says = say()</span><br><span class="line">console.log(`The $&#123;type&#125; says $&#123;says&#125; to $&#123;animal&#125;`)  </span><br><span class="line">//The dog says Hello to A cat</span><br></pre></td></tr></table></figure>
<p>修改变量名</p>
<p>此时我们不喜欢type这个变量名，因为它有可能重名，所以我们需要修改一下它的变量名。在es6中可以用<code>as</code>实现一键换名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line">import animal, &#123; say, type as animalType &#125; from &apos;./content&apos;  </span><br><span class="line">let says = say()</span><br><span class="line">console.log(`The $&#123;animalType&#125; says $&#123;says&#125; to $&#123;animal&#125;`)  </span><br><span class="line">//The dog says Hello to A cat</span><br></pre></td></tr></table></figure>
<p>模块的整体加载</p>
<p>除了指定加载某个输出值，还可以使用整体加载，即用星号（<code>*</code>）指定一个对象，所有输出值都加载在这个对象上面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//index.js</span><br><span class="line"></span><br><span class="line">import animal, * as content from &apos;./content&apos;  </span><br><span class="line">let says = content.say()</span><br><span class="line">console.log(`The $&#123;content.type&#125; says $&#123;says&#125; to $&#123;animal&#125;`)  </span><br><span class="line">//The dog says Hello to A cat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通常星号<code>*</code>结合<code>as</code>一起使用比较合适。</p>
</blockquote>
<h1 id="其他-特性"><a href="#其他-特性" class="headerlink" title="其他 特性"></a>其他 特性</h1><p><a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">阮一峰老师的es6入门</a></p>
<hr>
<p><a href="https://segmentfault.com/a/1190000004368132" target="_blank" rel="noopener">参考1</a></p>
<p><a href="https://segmentfault.com/a/1190000004365693" target="_blank" rel="noopener">参考2</a></p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/11/08/nodejs-document/">nodejs+express开发笔记</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-11-08
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h1 id="nodejs-开发笔记"><a href="#nodejs-开发笔记" class="headerlink" title="nodejs 开发笔记"></a>nodejs 开发笔记</h1><h2 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h2><p>在开发过程中，每次修改代码保存后，我们都需要手动重启程序，才能查看改动的效果。使用 <code>supervisor</code> 可以解决这个繁琐的问题，全局安装 <code>supervisor</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g supervisor</span><br></pre></td></tr></table></figure>
<p>运行 <code>supervisor --harmony index</code> 启动程序，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ supervisor --harmony index</span><br><span class="line"></span><br><span class="line">Running node-supervisor with</span><br><span class="line">  program &apos;--harmony index&apos;</span><br><span class="line">  --watch &apos;.&apos;</span><br><span class="line">  --extensions &apos;node,js&apos;</span><br><span class="line">  --exec &apos;node&apos;</span><br><span class="line"></span><br><span class="line">Starting child process with &apos;node --harmony index&apos;</span><br><span class="line">Watching directory &apos;/Users/shanshanxue/Documents/workspace/aym_admin_nav&apos; for changes.</span><br><span class="line">Press rs for restarting the process.</span><br></pre></td></tr></table></figure>
<p>supervisor 会监听当前目录下 node 和 js 后缀的文件，当这些文件发生改动时，supervisor 会自动重启程序。</p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var app = express();</span><br><span class="line"></span><br><span class="line">app.get(&apos;/&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;hello, express&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&apos;/users/:name&apos;, function(req, res) &#123;</span><br><span class="line">  res.send(&apos;hello, &apos; + req.params.name);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>
<p>以上代码的意思是：当访问根路径时，依然返回 <code>hello</code>, <code>express</code>，当访问如 <code>localhost:3000/users/nswbmw</code> 路径时，返回 <code>hello</code>, <code>nswbmw</code>。路径中 <code>:name</code> 起了占位符的作用，这个占位符的名字是 <code>name</code>，可以通过 <code>req.params.name</code> 取到实际的值。</p>
<blockquote>
<p>小提示：express 使用了 <code>path-to-regexp</code> 模块实现的路由匹配。</p>
</blockquote>
<p>不难看出：req 包含了请求来的相关信息，res 则用来返回该请求的响应，更多请查阅 express 官方文档。下面介绍几个常用的 req 的属性：</p>
<ul>
<li><code>req.query</code>: 解析后的 <code>url</code> 中的 <code>querystring</code>，如 <code>?name=haha</code>，<code>req.query</code> 的值为 <code>{name: &#39;haha&#39;}</code></li>
<li><code>req.params</code>: 解析 <code>url</code> 中的占位符，如 <code>/:name</code>，访问 <code>/haha</code>，<code>req.params</code> 的值为 <code>{name: &#39;haha&#39;}</code></li>
<li><code>req.body</code>: 解析后请求体，需使用相关的模块，如 <code>body-parser</code>，请求体为 <code>{&quot;name&quot;: &quot;haha&quot;}</code>，则 <code>req.body</code> 为 <code>{name: &#39;haha&#39;}</code></li>
</ul>
<h2 id="模板引擎ejs"><a href="#模板引擎ejs" class="headerlink" title="模板引擎ejs"></a>模板引擎ejs</h2><p>模板引擎有很多，<code>ejs</code> 是其中一种，因为它使用起来十分简单，而且与 <code>express</code> 集成良好，所以我们使用 <code>ejs</code>。安装 <code>ejs</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i ejs --save</span><br></pre></td></tr></table></figure>
<p><strong>ejs文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">      body &#123;padding: 50px;font: 14px &quot;Lucida Grande&quot;, Helvetica, Arial, sans-serif;&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%= name.toUpperCase() %&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;hello, &lt;%= name %&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>routes</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&apos;express&apos;);</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&apos;/:name&apos;, function(req, res) &#123;</span><br><span class="line">  res.render(&apos;users&apos;, &#123;</span><br><span class="line">    name: req.params.name</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>
<p>通过调用 <code>res.render</code> 函数渲染 <code>ejs</code> 模板，<code>res.render</code> 第一个参数是模板的名字，这里是 <code>users</code> 则会匹配 <code>views/users.ejs</code>，第二个参数是传给模板的数据，这里传入 <code>name</code>，则在 <code>ejs</code> 模板中可使用 <code>name</code>。<code>res.render</code> 的作用就是将模板和数据结合生成 <code>html</code>，同时设置响应头中的 <code>Content-Type: text/html</code>，告诉浏览器我返回的是 <code>html</code>，不是纯文本，要按 <code>html</code> 展示</p>
<p>上面代码可以看到，我们在模板 <code>&lt;%= name.toUpperCase() %&gt;</code> 中使用了 <code>JavaScript</code> 的语法 <code>.toUpperCase()</code> 将名字转化为大写，那这个 <code>&lt;%= xxx %&gt;</code> 是什么东西呢？<code>ejs</code> 有 <code>3</code> 种常用标签：</p>
<ol>
<li><code>&lt;% code %&gt;</code>：运行 <code>JavaScript</code> 代码，不输出</li>
<li><code>&lt;%= code %&gt;</code>：显示转义后的 <code>HTML</code> 内容</li>
<li><code>&lt;%- code %&gt;</code>：显示原始 <code>HTML</code> 内容</li>
</ol>
<blockquote>
<p>注意：<code>&lt;%= code %&gt;</code> 和 <code>&lt;%- code %&gt;</code> 都可以是 <code>JavaScript</code> 表达式生成的字符串，当变量 <code>code</code> 为普通字符串时，两者没有区别。当 <code>code</code> 比如为 <code>&lt;h1&gt;hello&lt;/h1&gt;</code> 这种字符串时，<code>&lt;%= code %&gt;</code> 会原样输出 <code>&lt;h1&gt;hello&lt;/h1&gt;</code>，而 <code>&lt;%- code %&gt;</code> 则会显示 <code>H1</code> 大的 <code>hello</code> 字符串。</p>
</blockquote>
<p>下面的例子解释了 <code>&lt;% code %&gt;</code> 的用法：</p>
<p>Data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supplies: [&apos;mop&apos;, &apos;broom&apos;, &apos;duster&apos;]</span><br></pre></td></tr></table></figure>
<p>Template</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;% for(var i=0; i&lt;supplies.length; i++) &#123;%&gt;</span><br><span class="line">   &lt;li&gt;&lt;%= supplies[i] %&gt;&lt;/li&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>Result</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li&gt;mop&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;broom&lt;/li&gt;</span><br><span class="line">  &lt;li&gt;duster&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h4 id="includes"><a href="#includes" class="headerlink" title="includes"></a>includes</h4><p>我们使用模板引擎通常不是一个页面对应一个模板，这样就失去了模板的优势，而是把模板拆成可复用的模板片段组合使用，如在 views 下新建 header.ejs 和 footer.ejs，并修改 users.ejs：</p>
<p><strong>views/header.ejs</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">      body &#123;padding: 50px;font: 14px &quot;Lucida Grande&quot;, Helvetica, Arial, sans-serif;&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br></pre></td></tr></table></figure>
<p><strong>views/footer.ejs</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><strong>views/users.ejs</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include(&apos;header&apos;) %&gt;</span><br><span class="line">  &lt;h1&gt;&lt;%= name.toUpperCase() %&gt;&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;hello, &lt;%= name %&gt;&lt;/p&gt;</span><br><span class="line">&lt;%- include(&apos;footer&apos;) %&gt;</span><br></pre></td></tr></table></figure>
<p>我们将原来的 <code>users.ejs</code> 拆成出了 <code>header.ejs</code> 和 <code>footer.ejs</code>，并在 <code>users.ejs</code> 通过 <code>ejs</code> 内置的 <code>include</code> 方法引入，从而实现了跟以前一个模板文件相同的功能。</p>
<blockquote>
<p>小提示：拆分模板组件通常有两个好处：</p>
<ol>
<li><p>模板可复用，减少重复代码</p>
</li>
<li><p>主模板结构清晰</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>注意：要用 <code>&lt;%- include(&#39;header&#39;) %&gt;</code> 而不是 <code>&lt;%= include(&#39;header&#39;) %&gt;</code></p>
</blockquote>
<h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>对应文件及文件夹的用处：</p>
<ol>
<li><code>models</code>: 存放操作数据库的文件</li>
<li><code>public</code>: 存放静态文件，如样式、图片等</li>
<li><code>routes</code>: 存放路由文件</li>
<li><code>views</code>: 存放模板文件</li>
<li><code>index.js</code>: 程序主文件</li>
<li><code>package.json</code>: 存储项目名、描述、作者、依赖等等信息</li>
</ol>
<blockquote>
<p>小提示：不知读者发现了没有，我们遵循了 <code>MVC</code>（模型(model)－视图(view)－控制器(controller/route)） 的开发模式。</p>
</blockquote>
<h3 id="安装依赖模块"><a href="#安装依赖模块" class="headerlink" title="安装依赖模块"></a>安装依赖模块</h3><p>运行以下命令安装所需的模块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i config-lite connect-flash connect-mongo ejs express express-formidable express-session marked moment mongolass objectid-to-timestamp sha1 winston express-winston --save</span><br></pre></td></tr></table></figure>
<p>对应模块的用处：</p>
<ol>
<li><code>express</code>: web 框架</li>
<li><code>express-session</code>: session 中间件</li>
<li><code>connect-mongo</code>: 将 session 存储于 mongodb，结合 express-session 使用</li>
<li><code>connect-flash</code>: 页面通知提示的中间件，基于 session 实现</li>
<li><code>ejs</code>: 模板</li>
<li><code>express-formidable</code>: 接收表单及文件的上传中间件</li>
<li><code>config-lite</code>: 读取配置文件</li>
<li><code>marked</code>: markdown 解析</li>
<li><code>moment</code>: 时间格式化</li>
<li><code>mongolass</code>: mongodb 驱动</li>
<li><code>objectid-to-timestamp</code>: 根据 ObjectId 生成时间戳</li>
<li><code>sha1</code>: sha1 加密，用于密码加密</li>
<li><code>winston</code>: 日志</li>
<li><code>express-winston</code>: 基于 winston 的用于 express 的日志中间件</li>
</ol>
<h2 id="config-lite"><a href="#config-lite" class="headerlink" title="config-lite"></a>config-lite</h2><p>不管是小项目还是大项目，将配置与代码分离是一个非常好的做法。我们通常将配置写到一个配置文件里，如 <code>config.js</code> 或 <code>config.json</code> ，并放到项目的根目录下。但通常我们都会有许多环境，如本地开发环境、测试环境和线上环境等，不同的环境的配置不同，我们不可能每次部署时都要去修改引用 <code>config.test.js</code> 或者 <code>config.production.js</code>。<code>config-lite</code> 模块正是你需要的。</p>
<p><code>config-lite</code> 是一个轻量的读取配置文件的模块。<code>config-lite</code> 会根据环境变量（<code>NODE_ENV</code>）的不同从当前执行进程目录下的 <code>config</code> 目录加载不同的配置文件。如果不设置 <code>NODE_ENV</code>，则读取默认的 <code>default</code> 配置文件，如果设置了 <code>NODE_ENV</code>，则会合并指定的配置文件和 <code>default</code> 配置文件作为配置，<code>config-lite</code> 支持 <code>.js</code>、<code>.json</code>、<code>.node</code>、<code>.yml</code>、<code>.yaml</code> 后缀的文件。</p>
<p>如果程序以 <code>NODE_ENV=test node app</code> 启动，则 <code>config-lite</code> 会依次降级查找 <code>config/test.js</code>、<code>config/test.json</code>、<code>config/test.node</code>、<code>config/test.yml</code>、<code>config/test.yaml</code> 并合并 <code>default</code> 配置; 如果程序以 <code>NODE_ENV=production node app</code> 启动，则 <code>config-lite</code> 会依次降级查找 <code>config/production.js</code>、<code>config/production.json</code>、<code>config/production.node</code>、<code>config/production.yml</code>、<code>config/production.yaml</code> 并合并 <code>default</code> 配置。</p>
<p>在 <code>myblog</code> 下新建 <code>config</code> 目录，在该目录下新建 <code>default.js</code>，添加如下代码：</p>
<p><strong>config/default.js</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  port: 3000,</span><br><span class="line">  session: &#123;</span><br><span class="line">    secret: &apos;myblog&apos;,</span><br><span class="line">    key: &apos;myblog&apos;,</span><br><span class="line">    maxAge: 2592000000</span><br><span class="line">  &#125;,</span><br><span class="line">  mongodb: &apos;mongodb://localhost:27017/myblog&apos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>配置释义：</p>
<ol>
<li><code>port</code>: 程序启动要监听的端口号</li>
<li><code>session</code>: <code>express-session</code> 的配置信息，后面介绍</li>
<li><code>mongodb</code>: <code>mongodb</code> 的地址，<code>myblog</code> 为 <code>db</code> 名</li>
</ol>
<h2 id="功能与路由设计"><a href="#功能与路由设计" class="headerlink" title="功能与路由设计"></a>功能与路由设计</h2><p>功能列表：<br>路由设计如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">注册 </span><br><span class="line">	* 注册页 ：GET /signup</span><br><span class="line">	* 注册方法： POST /signup</span><br><span class="line"></span><br><span class="line">登陆：</span><br><span class="line">	* 登陆页：GET /signin</span><br><span class="line">	* 登录：POST /signin</span><br><span class="line"></span><br><span class="line">登出：GET /signout</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">类目:</span><br><span class="line">查看类目 ： GET /category</span><br><span class="line">发表类目 ：</span><br><span class="line">   * 发表类目页面：GET /category/create</span><br><span class="line">   * 发表类目： POST /category</span><br><span class="line">修改类目： </span><br><span class="line">	修改类目页面： GET /category/:categoryId/edit</span><br><span class="line">	修改类目：POST /category/:categoryId/edit</span><br><span class="line">删除类目：GET /category/:categoryId/remove</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAV :</span><br><span class="line">查看nav</span><br><span class="line">	个人主页： GET /nav?user=xxx</span><br><span class="line">发表nav ：</span><br><span class="line">   * 发表nav页面：GET /nav/create</span><br><span class="line">   * 发表nav： POST /nav</span><br><span class="line">修改nav： </span><br><span class="line">	修改nav页面： GET /nav/:navId/edit</span><br><span class="line">	修改nav：POST /nav/:navId/edit</span><br><span class="line">删除nav：GET /nav/:navId/remove</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">用户与nav分类关联信息：</span><br><span class="line">user To Nav Category :</span><br><span class="line">添加分类页面： GET /userToCategory</span><br><span class="line">更新nav分类管理信息 ：POST /userToCategory/updata?userId=xxx&amp;categorys=1,2,3,4,4,5,6</span><br></pre></td></tr></table></figure>
<p>用户表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>id</td>
</tr>
<tr>
<td>用户名</td>
<td>name</td>
</tr>
<tr>
<td>密码</td>
<td>password</td>
</tr>
</tbody>
</table>
<p>nav表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>id</td>
</tr>
<tr>
<td>名称</td>
<td>title</td>
</tr>
<tr>
<td>内容</td>
<td>content</td>
</tr>
<tr>
<td>图片url</td>
<td>imgUrl</td>
</tr>
<tr>
<td>类别</td>
<td>categoryId</td>
</tr>
<tr>
<td>作者ID</td>
<td>userId</td>
</tr>
<tr>
<td>pv</td>
<td>pv</td>
</tr>
</tbody>
</table>
<p>nav分类：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>id</td>
</tr>
<tr>
<td>名称</td>
<td>name</td>
</tr>
</tbody>
</table>
<p>用户个人分类表（根据此表展示当前用户选择的分类下的所有nav）：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>id</td>
</tr>
<tr>
<td>用户id</td>
<td>userId</td>
</tr>
<tr>
<td>分类ID  （1，2，3，4，5）</td>
<td>categoryId</td>
</tr>
</tbody>
</table>
<p>接口结果格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">success : true，</span><br><span class="line">msg : &apos;&apos;,</span><br><span class="line">code : &apos;200&apos;,</span><br><span class="line">obj : &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/09/04/h5-wipe-cache/">设置清除html5页面缓存</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-09-04
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h3 id="html5端设置-meta-标签："><a href="#html5端设置-meta-标签：" class="headerlink" title="html5端设置 meta 标签："></a><code>html5</code>端设置 <code>meta</code> 标签：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Pragma&quot; content=&quot;no-cache&quot; /&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache&quot; /&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot; /&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p> 设置上面的只是紧紧可以保证<code>html</code>文件每次从服务器中获取，不从缓存文件中拿，而对于外链<code>CSS</code> <code>JS</code> <code>图片</code> 等文件仍旧是从缓存中获取的；</p>
</blockquote>
<h3 id="设置-css-JS文件不从缓存中读取"><a href="#设置-css-JS文件不从缓存中读取" class="headerlink" title="设置 css JS文件不从缓存中读取:"></a>设置 <code>css</code> <code>JS</code>文件不从缓存中读取:</h3><p>通过添加版本号的和随机数的方法，保证每次加载<code>JS</code> <code>CSS</code>连接都是最新的，通常的做法是添加一个版本号，在每次更新了<code>JS</code> <code>CSS</code>时给<strong>版本号+1</strong>，保证没有更新时采用缓存文件。</p>
<blockquote>
<p>不推荐加随机数的方法，每次都是最新的，没办法利用缓存提高性能。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/js/index.js?v=1.0.0&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>转载请注明出处</p>
<p>作者：xuess<a href="mailto:&#119;&#117;&#110;&#x69;&#117;&#x32;&#x30;&#49;&#x30;&#64;&#x31;&#x32;&#x36;&#46;&#x63;&#111;&#109;" target="_blank" rel="noopener">&#119;&#117;&#110;&#x69;&#117;&#x32;&#x30;&#49;&#x30;&#64;&#x31;&#x32;&#x36;&#46;&#x63;&#111;&#109;</a></p>
<p>时间：2017年08月08日</p>
<p>最后修改时间：2017年08月08日</p>
</blockquote>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/08/23/h5-css-js-redraw/">重排重绘</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-08-23
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h3 id="什么是重排和重绘"><a href="#什么是重排和重绘" class="headerlink" title="什么是重排和重绘"></a>什么是重排和重绘</h3><p>浏览器下载完页面中的所有组件——HTML标记、JavaScript、CSS、图片之后会解析生成两个内部数据结构——<strong>DOM树和渲染树</strong>。</p>
<p>DOM树表示页面结构，渲染树表示DOM节点如何显示。</p>
<p>DOM树中的每一个需要显示的节点在渲染树中至少存在一个对应的节点（隐藏的DOM元素disply值为none 在渲染树中没有对应的节点）。</p>
<p>渲染树中的节点被称为“帧”或“盒”,符合CSS模型的定义，理解页面元素为一个具有填充，边距，边框和位置的盒子。</p>
<p>一旦DOM和渲染树构建完成，浏览器就开始显示（绘制）页面元素。</p>
<p><code>document.createDocumentFragment()</code> ： 创建的是一次性的，用完即销毁</p>
<p>当DOM的变化影响了元素的几何属性(宽和高)，浏览器需要重新计算元素的几何属性，同样其他元素的几何属性和位置也会因此受到影响。</p>
<p>重排：浏览器会使渲染树中受到影响的部分失效，并重新构造渲染树。</p>
<p>重绘：完成重排后，浏览器会重新绘制受影响的部分到屏幕中。</p>
<p>重排何时发生：</p>
<p>添加或删除可见的DOM元素<br>元素位置的改变<br>元素尺寸改变<br>内容改变<br>页面渲染器初始化<br>浏览器窗口尺寸的改变</p>

        
      
    </div>

    

    

  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/06/09/code-block/">常用代码片段</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-06-09
        </span>
        
        
      </div>
    </header>

    
    

    <div class="post-content">
      
        
        

        
          <h1 id="常用代码片段"><a href="#常用代码片段" class="headerlink" title="常用代码片段"></a>常用代码片段</h1><h3 id="a标签创建连接点击跳转"><a href="#a标签创建连接点击跳转" class="headerlink" title="a标签创建连接点击跳转"></a>a标签创建连接点击跳转</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(el);</span><br><span class="line">el.href = <span class="string">'http://www.baidu.com'</span>; <span class="comment">//url 是你得到的连接</span></span><br><span class="line"><span class="comment">//el.target = '_new'; //指定在新窗口打开</span></span><br><span class="line">el.click();</span><br><span class="line"><span class="built_in">document</span>.body.removeChild(el);</span><br><span class="line"><span class="keyword">return</span> ;</span><br></pre></td></tr></table></figure>
<h3 id="transform垂直左右居中"><a href="#transform垂直左右居中" class="headerlink" title="transform垂直左右居中"></a>transform垂直左右居中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">width: 80%;</span><br><span class="line">padding: 10px;</span><br><span class="line">border: 1px solid #E94637;</span><br><span class="line">position: fixed;</span><br><span class="line">text-align: center;</span><br><span class="line">z-index: 13;</span><br><span class="line">left: 50%;</span><br><span class="line">top: 50%;</span><br><span class="line">transform: translate(-50%, -50%);</span><br><span class="line">-webkit-transform: translate(-50%, -50%);</span><br></pre></td></tr></table></figure>
<h3 id="js异步上传-from表单"><a href="#js异步上传-from表单" class="headerlink" title="js异步上传 from表单"></a>js异步上传 from表单</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步上传</span></span><br><span class="line"><span class="keyword">new</span> FormData($(<span class="string">'#uploadForm'</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h3 id="事件节流"><a href="#事件节流" class="headerlink" title="事件节流"></a>事件节流</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 事件节流 或者 防止滚动卡顿 17毫秒左右每帧</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; fn</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; interval</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, interval</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> doing = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(doing) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		doing = <span class="literal">true</span>;</span><br><span class="line">		fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">		setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			doing = <span class="literal">false</span>;</span><br><span class="line">		&#125;, interval);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="vue初始化模板"><a href="#vue初始化模板" class="headerlink" title="vue初始化模板"></a>vue初始化模板</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	el: <span class="string">"#main"</span>,</span><br><span class="line">	data: &#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//计算属性</span></span><br><span class="line">	computed: &#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">	methods: &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//监听</span></span><br><span class="line">	watch: &#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//	生命周期钩子的一些使用方法：</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//	beforecreate : 可以在这加个loading事件，在加载实例时触发</span></span><br><span class="line">	<span class="comment">//	created : 初始化完成时的事件写在这里，如在这结束loading事件，异步请求也适宜在这里调用</span></span><br><span class="line">	<span class="comment">//	mounted : 挂载元素，获取到DOM节点</span></span><br><span class="line">	<span class="comment">//	updated : 如果对数据统一处理，在这里写上相应函数</span></span><br><span class="line">	<span class="comment">//	beforeDestroy : 可以做一个确认停止事件的确认框</span></span><br><span class="line">	<span class="comment">//	nextTick : 更新数据后立即操作dom</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//vue实例创建之前</span></span><br><span class="line">	beforecreate: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//vue实例创建之后</span></span><br><span class="line">	created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
        
      
    </div>

    

    

  </article>

    
  </section>

  
  <nav class="pagination">
    
      <a class="prev" href="/page/2/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">上一页</span>
      </a>
    
    
      <a class="next" href="/page/4/">
        <span class="next-text">下一页</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:wuniu2010@126.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/xuess" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a href="https://weibo.com/test5433" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a href="https://www.zhihu.com/people/shan-xue-74/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
      
    
      
    
      
    
    
    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2016 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">xuess</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
